# Spooky Vocab 实施路线图

**项目名称**: Spooky Vocab - 智能英语单词助手  
**当前阶段**: 协议定义完成，准备前后端集成  
**更新日期**: 2025-11-30

---

## 📊 项目进度总览

```
阶段一：前端Mock版本         ████████████████████ 100% ✅
阶段二：后端API开发          ████████████████████ 100% ✅
阶段三：协议文档制定         ████████████████████ 100% ✅
阶段四：前后端集成           ░░░░░░░░░░░░░░░░░░░░   0% ⏳
阶段五：测试与优化           ░░░░░░░░░░░░░░░░░░░░   0% 📅
阶段六：生产环境部署         ░░░░░░░░░░░░░░░░░░░░   0% 📅
```

**总体进度**: 50%

---

## ✅ 已完成工作

### 阶段一：前端Mock版本（11月30日完成）

**提交**: `7a6f143`  
**状态**: ✅ 完成并测试

#### 功能清单

- ✅ Chrome Extension Manifest V3配置
- ✅ 页面文本遍历和英文分词（TreeWalker API）
- ✅ Mock词汇数据（500常见词 + 50难词）
- ✅ 翻译浮层UI（Shadow DOM隔离）
- ✅ 智能定位算法（PC + 移动端）
- ✅ 设备检测和响应式交互
  - PC端：悬停显示，双击强制翻译
  - 移动端：点击切换，长按翻译
- ✅ 用户反馈系统（本地存储）
- ✅ Popup统计界面
- ✅ 完整文档和测试指南

#### 代码统计

- JavaScript: 1,400行
- HTML/CSS: 500行
- 文档: 1,200行
- 文件数: 22个

### 阶段二：后端API开发（11月30日完成）

**提交**: `74b92c1`  
**状态**: ✅ 完成

#### 功能清单

- ✅ Express + SQLite后端服务器
- ✅ ECDICT词典集成（支持80万词）
- ✅ JWT认证中间件（测试阶段）
- ✅ 自适应学习算法（熟悉度评分0-100）
- ✅ RESTful API端点：
  - 词汇批量检查
  - 用户反馈记录
  - 复习列表生成
  - 学习统计
  - 用户设置管理

#### 代码统计

- JavaScript: 1,700行
- 文档: 800行
- 文件数: 15个

#### 技术特性

- better-sqlite3高性能数据库
- WAL模式并发优化
- 完善的错误处理
- 优雅降级机制

### 阶段三：协议文档制定（11月30日完成）

**提交**: `586c112`  
**状态**: ✅ 完成

#### 文档清单

- ✅ **API_SPECIFICATION.md** (2,000行)
  - JWT认证机制详细说明
  - 所有API端点规范
  - 请求/响应格式
  - 错误代码定义
  - 安全考虑

- ✅ **FRONTEND_INTEGRATION.md** (1,800行)
  - 架构设计
  - JWT管理器实现
  - API客户端实现
  - 数据流程图
  - 错误处理策略
  - 离线支持方案
  - 缓存管理
  - 性能优化

#### 关键决策

1. **JWT认证**: 
   - 测试阶段使用简化JWT
   - 生产阶段完整JWT验证
   - Token自动刷新机制

2. **用户识别**:
   - 从JWT payload提取user_id
   - 不再使用明文user_id
   - 支持多设备同步

3. **离线支持**:
   - 本地队列缓存操作
   - 网络恢复自动同步
   - 本地缓存降级

---

## ⏳ 当前阶段：准备集成

### 核心文档已就绪

| 文档 | 作用 | 状态 |
|------|------|------|
| API_SPECIFICATION.md | 后端API标准 | ✅ 完成 |
| FRONTEND_INTEGRATION.md | 前端实现指南 | ✅ 完成 |
| chrome.plan.md | 原始开发计划 | ✅ 参考 |
| PHASE2_SUMMARY.md | 阶段二总结 | ✅ 完成 |

### 实施标准

**所有后续开发必须严格遵循以下文档：**

1. **API规范** (`API_SPECIFICATION.md`)
   - 所有API调用格式
   - JWT token使用方式
   - 错误处理标准

2. **前端集成指南** (`FRONTEND_INTEGRATION.md`)
   - 代码结构标准
   - JWT管理实现
   - API客户端实现
   - 数据流程

---

## 📅 阶段四：前后端集成（下一步）

### 预计时间

开始：待定  
预计完成：2-3天

### 工作清单

#### 4.1 后端JWT实现 ⏳

**优先级**: P0（最高）

- [ ] 更新认证中间件（`backend/src/middleware/auth.js`）
  - 从JWT payload提取user_id
  - 验证JWT签名
  - 处理token过期

- [ ] 实现测试token端点（`POST /api/auth/test-token`）
  - 生成简单JWT
  - 包含user_id和过期时间

- [ ] 实现token刷新端点（`POST /api/auth/refresh`）
  - 验证旧token
  - 生成新token

**验收标准**:
- JWT中间件正确提取user_id
- 测试token端点可用
- 过期token被正确拒绝

#### 4.2 前端JWT管理 ⏳

**优先级**: P0

- [ ] 创建配置文件（`extension/config.js`）
  - API服务器地址
  - JWT配置
  - 性能参数

- [ ] 实现JWT管理器（`extension/content/jwt-manager.js`）
  - Token存储和读取
  - Token验证
  - 自动刷新逻辑

- [ ] 创建API客户端（`extension/content/api-client.js`）
  - 基础HTTP请求封装
  - JWT header自动添加
  - 错误处理和重试
  - 所有API方法实现

**验收标准**:
- JWT正确存储在chrome.storage
- Token过期自动刷新
- API调用自动携带JWT

#### 4.3 更新Content Script ⏳

**优先级**: P1

- [ ] 更新main.js
  - 集成JWT管理器
  - 集成API客户端
  - 移除Mock数据依赖

- [ ] 更新text-processor.js
  - 调用真实API检查词汇
  - 处理API响应
  - 降级策略

- [ ] 更新feedback-handler.js
  - 调用API记录反馈
  - 离线队列支持

**验收标准**:
- 单词检查使用真实API
- Mock数据仅作为降级方案
- 用户反馈正确同步到服务器

#### 4.4 更新Popup界面 ⏳

**优先级**: P1

- [ ] 更新popup.js
  - 显示真实学习统计
  - 调用API获取复习列表
  - Token管理界面

- [ ] 添加登录/认证UI
  - 测试阶段：简单user_id输入
  - 生产阶段：完整登录表单

**验收标准**:
- 统计数据来自API
- 复习列表可用
- 用户可以设置CEFR等级

#### 4.5 离线支持 ⏳

**优先级**: P2

- [ ] 实现离线队列
  - 操作缓存
  - 自动同步

- [ ] 实现本地缓存
  - 词汇结果缓存
  - 缓存过期管理

**验收标准**:
- 离线时操作被队列化
- 恢复网络自动同步
- 缓存正确使用

---

## 📅 阶段五：测试与优化（计划中）

### 预计时间

开始：阶段四完成后  
预计完成：1-2天

### 工作清单

#### 5.1 功能测试

- [ ] 端到端测试
  - 完整用户流程
  - 各种边界情况
  
- [ ] API测试
  - 所有端点功能
  - 错误处理
  - 性能测试

- [ ] 兼容性测试
  - Chrome桌面版
  - Kiwi Browser移动端
  - 各种网站兼容性

#### 5.2 性能优化

- [ ] 前端性能
  - 减少API请求次数
  - 优化批量处理
  - 缓存优化

- [ ] 后端性能
  - 数据库查询优化
  - 响应时间优化
  - 并发处理

#### 5.3 用户体验

- [ ] 加载状态提示
- [ ] 错误提示优化
- [ ] 离线提示
- [ ] 动画流畅度

---

## 📅 阶段六：生产环境部署（计划中）

### 预计时间

TBD

### 工作清单

#### 6.1 后端部署

- [ ] 选择云服务商
  - Railway / Render / Vercel
  - 或自建服务器

- [ ] 环境配置
  - 生产数据库
  - JWT密钥管理
  - HTTPS证书

- [ ] 监控和日志
  - 错误监控
  - 性能监控
  - 访问日志

#### 6.2 Chrome扩展发布

- [ ] 准备发布资料
  - 应用商店描述
  - 截图和预览视频
  - 隐私政策

- [ ] 提交审核
  - Chrome Web Store
  - 审核和修改

#### 6.3 用户系统

- [ ] 完整登录系统
  - 邮箱注册/登录
  - 密码加密
  - 忘记密码

- [ ] OAuth集成（可选）
  - Google登录
  - GitHub登录

---

## 📈 技术债务和改进

### 当前已知问题

1. **ECDICT词典大小**
   - 约200MB，需手动下载
   - 考虑：在线词典API？压缩？

2. **测试覆盖率**
   - 目前无自动化测试
   - 需要：单元测试、集成测试

3. **错误监控**
   - 缺少生产环境错误追踪
   - 需要：Sentry或类似工具

### 未来增强功能

1. **复习功能增强**
   - 间隔重复算法（Spaced Repetition）
   - 卡片式复习界面
   - 复习提醒

2. **词汇导出**
   - 导出为Anki卡片
   - 导出为CSV
   - 学习报告

3. **社区功能**
   - 词汇分享
   - 学习小组
   - 排行榜

4. **多语言支持**
   - 界面多语言
   - 其他语言学习支持

---

## 🎯 里程碑

| 里程碑 | 预计完成 | 状态 |
|--------|---------|------|
| M1: 前端Mock版本 | 2025-11-30 | ✅ 已完成 |
| M2: 后端API开发 | 2025-11-30 | ✅ 已完成 |
| M3: 协议文档制定 | 2025-11-30 | ✅ 已完成 |
| M4: 前后端集成 | TBD | ⏳ 进行中 |
| M5: 测试与优化 | TBD | 📅 计划中 |
| M6: 生产环境部署 | TBD | 📅 计划中 |
| M7: 公开发布 | TBD | 📅 计划中 |

---

## 📊 代码统计总览

### 当前代码量

| 类型 | 行数 | 文件数 |
|------|------|--------|
| 前端代码 | 1,900 | 11 |
| 后端代码 | 1,700 | 15 |
| 配置文件 | 200 | 4 |
| 文档 | 8,000+ | 10+ |
| **总计** | **11,800+** | **40+** |

### Git提交历史

```
586c112 - docs: Add detailed API specification          (HEAD)
6e75e22 - docs: Add Phase 2 completion summary
74b92c1 - feat: Add backend API server (Phase 2)
7a6f143 - feat: Initial commit (Phase 1)
```

---

## 🚀 下一步行动

### 立即可做

1. **后端JWT实现** (2-3小时)
   - 更新auth中间件
   - 添加test-token端点
   - 测试JWT验证

2. **前端JWT管理器** (2-3小时)
   - 实现jwt-manager.js
   - 测试token存储和验证

3. **API客户端** (3-4小时)
   - 实现api-client.js
   - 封装所有API调用

### 本周目标

- ✅ 完成后端JWT实现
- ✅ 完成前端JWT管理
- ✅ 完成API客户端
- ✅ 更新content script使用API

### 本月目标

- ✅ 完成前后端完整集成
- ✅ 完成功能测试
- ✅ 优化性能
- ✅ 准备生产环境部署

---

## 📞 项目联系

**项目仓库**: https://git.wemomo.com/yu.zhenyu/spookyvocab  
**开发者**: yu.zhenyu  
**更新频率**: 持续开发中

---

## 📄 相关文档

- **API规范**: `API_SPECIFICATION.md`
- **前端集成**: `FRONTEND_INTEGRATION.md`
- **阶段二总结**: `PHASE2_SUMMARY.md`
- **快速开始**: `QUICK_START.md`
- **部署清单**: `DEPLOYMENT_CHECKLIST.md`

---

**当前状态**: 🟡 协议定义完成，准备开始集成  
**下一里程碑**: M4 - 前后端集成  
**预计完成**: 待定（取决于开发时间安排）

---

*最后更新: 2025-11-30*

